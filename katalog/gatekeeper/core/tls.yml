# Copyright (c) 2020 SIGHUP s.r.l All rights reserved.
# Use of this source code is governed by a BSD-style
# license that can be found in the LICENSE file.

---
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  name: gatekeeper-selfsign
  labels:
    k8s-app: gatekeeper
spec:
  selfSigned: {}
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: gatekeeper-ca
  labels:
    k8s-app: gatekeeper
spec:
  secretName: gatekeeper-ca
  duration: 43800h
  issuerRef:
    name: gatekeeper-selfsign
  commonName: "ca.gatekeeper.gatekeeper-system"
  isCA: true
---
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  name: gatekeeper-ca
  labels:
    k8s-app: gatekeeper
spec:
  ca:
    secretName: gatekeeper-ca
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: gatekeeper-tls
  labels:
    k8s-app: gatekeeper
spec:
  secretName: gatekeeper-tls
  duration: 8760h
  issuerRef:
    name: gatekeeper-ca
  dnsNames:
    - gatekeeper-webhook-service
    - gatekeeper-webhook-service.gatekeeper-system
    - gatekeeper-webhook-service.gatekeeper-system.svc
